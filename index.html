<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>MQTT Data Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Temperatur & Fukt</h1>
  <canvas id="chart" width="600" height="400"></canvas>

  <script>
  const ctx = document.getElementById('chart').getContext('2d');
  const data = {
    labels: [],
    datasets: [
      {
        label: 'Temperatur (Â°C)',
        data: [],
        borderColor: 'red',
        fill: false
      },
      {
        label: 'Fukt (%)',
        data: [],
        borderColor: 'blue',
        fill: false
      }
    ]
  };

  const chart = new Chart(ctx, {
    type: 'line',
    data: data,
    options: { responsive: true, animation: false }
  });

  // Anslut till WebSocket-server
const ws = new WebSocket('ws://localhost:8080');


  ws.onmessage = event => {
    try {
      const obj = JSON.parse(event.data);
      const time = new Date().toLocaleTimeString();

      data.labels.push(time);
      data.datasets[0].data.push(obj.temp);
      data.datasets[1].data.push(obj.humidity);

      if (data.labels.length > 10) { // visa max 10 punkter
        data.labels.shift();
        data.datasets[0].data.shift();
        data.datasets[1].data.shift();
      }

      chart.update();
    } catch (e) {
      console.error("Fel vid JSON:", e);
    }
  };
</script>
</body>
</html>
